# Aether Identity Package Ecosystem Makefile
# Multi-language SDK management and build orchestration

.PHONY: help install clean build test lint format typecheck
.PHONY: build-all build-node build-golang build-swift build-docker build-github build-cli
.PHONY: test-all test-node test-golang test-swift test-docker test-github test-cli
.PHONY: dev dev-node dev-golang dev-docker dev-github dev-cli
.PHONY: publish publish-node publish-docker publish-shared
.PHONY: build-python build-rust build-java build-dotnet build-php build-ruby
.PHONY: test-python test-rust test-java test-dotnet test-php test-ruby

# Default target
.DEFAULT_GOAL := help

# Variables
PNPM := pnpm
NODE_VERSION := 18.0.0
GO_VERSION := 1.21
SWIFT_VERSION := 5.9

# Colors for output
BLUE := \033[36m
GREEN := \033[32m
YELLOW := \033[33m
RED := \033[31m
RESET := \033[0m

## ðŸš€ Quick Start & Help
help: ## Show all available commands
	@echo "$(BLUE)ðŸ“¦ Aether Identity Package Ecosystem$(RESET)"
	@echo ""
	@echo "$(GREEN)ðŸš€ Quick Start:$(RESET)"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / && /Quick/ {printf "  $(YELLOW)%-25s$(RESET) %s\n", $$1, $$2}' $(MAKEFILE_LIST)
	@echo ""
	@echo "$(GREEN)ðŸ—ï¸ Build Commands:$(RESET)"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / && /Build/ {printf "  $(YELLOW)%-25s$(RESET) %s\n", $$1, $$2}' $(MAKEFILE_LIST)
	@echo ""
	@echo "$(GREEN)ðŸ§ª Test Commands:$(RESET)"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / && /Test/ {printf "  $(YELLOW)%-25s$(RESET) %s\n", $$1, $$2}' $(MAKEFILE_LIST)
	@echo ""
	@echo "$(GREEN)ðŸ”§ Development:$(RESET)"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / && /Development/ {printf "  $(YELLOW)%-25s$(RESET) %s\n", $$1, $$2}' $(MAKEFILE_LIST)
	@echo ""
	@echo "$(GREEN)ðŸ“¦ Publishing:$(RESET)"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / && /Publish/ {printf "  $(YELLOW)%-25s$(RESET) %s\n", $$1, $$2}' $(MAKEFILE_LIST)
	@echo ""
	@echo "$(GREEN)ðŸ§¹ Maintenance:$(RESET)"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / && /Maintenance/ {printf "  $(YELLOW)%-25s$(RESET) %s\n", $$1, $$2}' $(MAKEFILE_LIST)

## ðŸ“¦ Installation & Setup
install: ## Quick - Install all dependencies
	@echo "$(BLUE)ðŸ“¦ Installing package ecosystem dependencies...$(RESET)"
	@$(PNPM) install
	@echo "$(GREEN)âœ… Dependencies installed$(RESET)"

install-node: ## Quick - Install Node.js dependencies only
	@echo "$(BLUE)ðŸ“¦ Installing Node.js dependencies...$(RESET)"
	@$(PNPM) install

install-golang: ## Quick - Install Go dependencies
	@echo "$(BLUE)ðŸ“¦ Installing Go dependencies...$(RESET)"
	@cd golang && go mod download

install-swift: ## Quick - Install Swift dependencies
	@echo "$(BLUE)ðŸ“¦ Installing Swift dependencies...$(RESET)"
	@cd swift && swift package resolve

## ðŸ—ï¸ Build Commands - All Packages
build-all: ## Build - Build all packages (TypeScript + Go + Swift)
	@echo "$(BLUE)ðŸ—ï¸ Building all packages...$(RESET)"
	@$(MAKE) build-node
	@$(MAKE) build-golang
	@$(MAKE) build-swift
	@$(MAKE) build-docker
	@$(MAKE) build-github
	@$(MAKE) build-cli
	@echo "$(GREEN)âœ… All packages built successfully$(RESET)"

build: ## Build - Build all TypeScript packages
	@echo "$(BLUE)ðŸ—ï¸ Building TypeScript packages...$(RESET)"
	@$(PNPM) build

## ðŸ—ï¸ Build Commands - Individual Packages
build-node: ## Build - Build Node.js SDK
	@echo "$(BLUE)ðŸ“¦ Building Node.js SDK...$(RESET)"
	@cd node && $(PNPM) build

build-golang: ## Build - Build Go SDK
	@echo "$(BLUE)ðŸ¹ Building Go SDK...$(RESET)"
	@cd golang && go build ./...

build-swift: ## Build - Build Swift SDK
	@echo "$(BLUE)ðŸ“± Building Swift SDK...$(RESET)"
	@cd swift && swift build

build-docker: ## Build - Build Docker SDK
	@echo "$(BLUE)ðŸ³ Building Docker SDK...$(RESET)"
	@cd docker && $(PNPM) build

build-github: ## Build - Build GitHub App
	@echo "$(BLUE)ðŸ™ Building GitHub App...$(RESET)"
	@cd github && go build

build-cli: ## Build - Build CLI tool
	@echo "$(BLUE)ðŸ› ï¸ Building CLI tool...$(RESET)"
	@cd cli && go build

build-vscode: ## Build - Build VSCode Extension
	@echo "$(BLUE)ðŸ“ Building VSCode Extension...$(RESET)"
	@cd vscode && $(PNPM) build

build-shared: ## Build - Build shared types
	@echo "$(BLUE)ðŸ“‹ Building shared types...$(RESET)"
	@cd shared && $(PNPM) build

build-action: ## Build - Build GitHub Action
	@echo "$(BLUE)âš¡ Building GitHub Action...$(RESET)"
	@cd action && echo "GitHub Action ready"

## ðŸ—ï¸ Build Commands - Work In Progress
build-python: ## Build - Build Python SDK (WIP)
	@echo "$(BLUE)ðŸ Building Python SDK...$(RESET)"
	@if [ -d "python" ]; then cd python && python -m build; else echo "$(YELLOW)âš ï¸ Python SDK not yet implemented$(RESET)"; fi

build-rust: ## Build - Build Rust SDK (WIP)
	@echo "$(BLUE)ðŸ¦€ Building Rust SDK...$(RESET)"
	@if [ -d "rust" ]; then cd rust && cargo build; else echo "$(YELLOW)âš ï¸ Rust SDK not yet implemented$(RESET)"; fi

build-java: ## Build - Build Java SDK (WIP)
	@echo "$(BLUE)â˜• Building Java SDK...$(RESET)"
	@if [ -d "java" ]; then cd java && mvn compile; else echo "$(YELLOW)âš ï¸ Java SDK not yet implemented$(RESET)"; fi

build-dotnet: ## Build - Build .NET SDK (WIP)
	@echo "$(BLUE)ðŸŸ£ Building .NET SDK...$(RESET)"
	@if [ -d ".net" ]; then cd .net && dotnet build; else echo "$(YELLOW)âš ï¸ .NET SDK not yet implemented$(RESET)"; fi

build-php: ## Build - Build PHP SDK (WIP)
	@echo "$(BLUE)ðŸ˜ Building PHP SDK...$(RESET)"
	@if [ -d "php" ]; then cd php && composer install; else echo "$(YELLOW)âš ï¸ PHP SDK not yet implemented$(RESET)"; fi

build-ruby: ## Build - Build Ruby SDK (WIP)
	@echo "$(BLUE)ðŸ’Ž Building Ruby SDK...$(RESET)"
	@if [ -d "ruby" ]; then cd ruby && bundle install; else echo "$(YELLOW)âš ï¸ Ruby SDK not yet implemented$(RESET)"; fi

build-k8s: ## Build - Build Kubernetes Operator (WIP)
	@echo "$(BLUE)â˜¸ï¸ Building Kubernetes Operator...$(RESET)"
	@if [ -d "k8s" ]; then cd k8s && go build; else echo "$(YELLOW)âš ï¸ Kubernetes Operator not yet implemented$(RESET)"; fi

build-extension: ## Build - Build Browser Extension (WIP)
	@echo "$(BLUE)ðŸ”Œ Building Browser Extension...$(RESET)"
	@if [ -d "extension" ]; then cd extension && $(PNPM) build; else echo "$(YELLOW)âš ï¸ Browser Extension not yet implemented$(RESET)"; fi

build-snap: ## Build - Build Snap Package (WIP)
	@echo "$(BLUE)ðŸ“¦ Building Snap Package...$(RESET)"
	@if [ -d "snap" ]; then cd snap && snapcraft; else echo "$(YELLOW)âš ï¸ Snap Package not yet implemented$(RESET)"; fi

build-gcc: ## Build - Build GCC Plugin (WIP)
	@echo "$(BLUE)ðŸ”§ Building GCC Plugin...$(RESET)"
	@if [ -d "gcc" ]; then cd gcc && make; else echo "$(YELLOW)âš ï¸ GCC Plugin not yet implemented$(RESET)"; fi

## ðŸ§ª Test Commands - All Packages
test-all: ## Test - Test all packages
	@echo "$(BLUE)ðŸ§ª Testing all packages...$(RESET)"
	@$(MAKE) test-node
	@$(MAKE) test-golang
	@$(MAKE) test-swift
	@$(MAKE) test-docker
	@$(MAKE) test-github
	@$(MAKE) test-cli
	@echo "$(GREEN)âœ… All tests completed$(RESET)"

test: ## Test - Test all TypeScript packages
	@echo "$(BLUE)ðŸ§ª Testing TypeScript packages...$(RESET)"
	@$(PNPM) test

## ðŸ§ª Test Commands - Individual Packages
test-node: ## Test - Test Node.js SDK
	@echo "$(BLUE)ðŸ“¦ Testing Node.js SDK...$(RESET)"
	@cd node && $(PNPM) test

test-golang: ## Test - Test Go SDK
	@echo "$(BLUE)ðŸ¹ Testing Go SDK...$(RESET)"
	@cd golang && go test ./...

test-swift: ## Test - Test Swift SDK
	@echo "$(BLUE)ðŸ“± Testing Swift SDK...$(RESET)"
	@cd swift && swift test

test-docker: ## Test - Test Docker SDK
	@echo "$(BLUE)ðŸ³ Testing Docker SDK...$(RESET)"
	@cd docker && $(PNPM) test

test-github: ## Test - Test GitHub App
	@echo "$(BLUE)ðŸ™ Testing GitHub App...$(RESET)"
	@cd github && go test ./...

test-cli: ## Test - Test CLI tool
	@echo "$(BLUE)ðŸ› ï¸ Testing CLI tool...$(RESET)"
	@cd cli && go test ./...

test-vscode: ## Test - Test VSCode Extension
	@echo "$(BLUE)ðŸ“ Testing VSCode Extension...$(RESET)"
	@cd vscode && $(PNPM) test

test-shared: ## Test - Test shared types
	@echo "$(BLUE)ðŸ“‹ Testing shared types...$(RESET)"
	@cd shared && $(PNPM) test

## ðŸ§ª Test Commands - Work In Progress
test-python: ## Test - Test Python SDK (WIP)
	@echo "$(BLUE)ðŸ Testing Python SDK...$(RESET)"
	@if [ -d "python" ]; then cd python && pytest; else echo "$(YELLOW)âš ï¸ Python SDK not yet implemented$(RESET)"; fi

test-rust: ## Test - Test Rust SDK (WIP)
	@echo "$(BLUE)ðŸ¦€ Testing Rust SDK...$(RESET)"
	@if [ -d "rust" ]; then cd rust && cargo test; else echo "$(YELLOW)âš ï¸ Rust SDK not yet implemented$(RESET)"; fi

test-java: ## Test - Test Java SDK (WIP)
	@echo "$(BLUE)â˜• Testing Java SDK...$(RESET)"
	@if [ -d "java" ]; then cd java && mvn test; else echo "$(YELLOW)âš ï¸ Java SDK not yet implemented$(RESET)"; fi

test-dotnet: ## Test - Test .NET SDK (WIP)
	@echo "$(BLUE)ðŸŸ£ Testing .NET SDK...$(RESET)"
	@if [ -d ".net" ]; then cd .net && dotnet test; else echo "$(YELLOW)âš ï¸ .NET SDK not yet implemented$(RESET)"; fi

test-php: ## Test - Test PHP SDK (WIP)
	@echo "$(BLUE)ðŸ˜ Testing PHP SDK...$(RESET)"
	@if [ -d "php" ]; then cd php && vendor/bin/phpunit; else echo "$(YELLOW)âš ï¸ PHP SDK not yet implemented$(RESET)"; fi

test-ruby: ## Test - Test Ruby SDK (WIP)
	@echo "$(BLUE)ðŸ’Ž Testing Ruby SDK...$(RESET)"
	@if [ -d "ruby" ]; then cd ruby && bundle exec rspec; else echo "$(YELLOW)âš ï¸ Ruby SDK not yet implemented$(RESET)"; fi

## ðŸ”§ Development Commands
dev: ## Development - Start all TypeScript packages in dev mode
	@echo "$(BLUE)ðŸ”§ Starting development mode for all packages...$(RESET)"
	@$(PNPM) dev

dev-node: ## Development - Start Node.js SDK in dev mode
	@echo "$(BLUE)ðŸ“¦ Starting Node.js SDK development...$(RESET)"
	@cd node && $(PNPM) dev

dev-docker: ## Development - Start Docker SDK in dev mode
	@echo "$(BLUE)ðŸ³ Starting Docker SDK development...$(RESET)"
	@cd docker && $(PNPM) dev

dev-vscode: ## Development - Start VSCode Extension in dev mode
	@echo "$(BLUE)ðŸ“ Starting VSCode Extension development...$(RESET)"
	@cd vscode && $(PNPM) dev

dev-github: ## Development - Start GitHub App in dev mode
	@echo "$(BLUE)ðŸ™ Starting GitHub App development...$(RESET)"
	@cd github && go run main.go

dev-cli: ## Development - Start CLI in dev mode
	@echo "$(BLUE)ðŸ› ï¸ Starting CLI development...$(RESET)"
	@cd cli && go run main.go

dev-golang: ## Development - Watch Go SDK for changes
	@echo "$(BLUE)ðŸ¹ Starting Go SDK development (watch mode)...$(RESET)"
	@cd golang && air

## ðŸ”§ Code Quality
lint: ## Code - Lint all TypeScript packages
	@echo "$(BLUE)ðŸ” Linting all packages...$(RESET)"
	@$(PNPM) lint

lint-fix: ## Code - Fix linting issues
	@echo "$(BLUE)ðŸ”§ Fixing linting issues...$(RESET)"
	@$(PNPM) lint:fix

typecheck: ## Code - Type check all TypeScript packages
	@echo "$(BLUE)ðŸ” Type checking all packages...$(RESET)"
	@$(PNPM) typecheck

format: ## Code - Format all code
	@echo "$(BLUE)ðŸ’… Formatting code...$(RESET)"
	@$(PNPM) format

format-check: ## Code - Check code formatting
	@echo "$(BLUE)ðŸ” Checking code formatting...$(RESET)"
	@$(PNPM) format:check

## ðŸ“¦ Publishing Commands
publish: ## Publish - Publish all packages
	@echo "$(BLUE)ðŸ“¦ Publishing all packages...$(RESET)"
	@$(MAKE) publish-node
	@$(MAKE) publish-docker
	@$(MAKE) publish-shared

publish-node: ## Publish - Publish Node.js SDK
	@echo "$(BLUE)ðŸ“¦ Publishing Node.js SDK...$(RESET)"
	@cd node && $(PNPM) publish

publish-docker: ## Publish - Publish Docker SDK
	@echo "$(BLUE)ðŸ³ Publishing Docker SDK...$(RESET)"
	@cd docker && $(PNPM) publish

publish-shared: ## Publish - Publish shared types
	@echo "$(BLUE)ðŸ“‹ Publishing shared types...$(RESET)"
	@cd shared && $(PNPM) publish

## ðŸ§¹ Maintenance Commands
clean: ## Maintenance - Clean all build artifacts and dependencies
	@echo "$(BLUE)ðŸ§¹ Cleaning package ecosystem...$(RESET)"
	@$(PNPM) clean
	@cd golang && go clean
	@cd swift && swift package clean
	@cd github && go clean
	@cd cli && go clean
	@echo "$(GREEN)âœ… Clean complete$(RESET)"

clean-node: ## Maintenance - Clean Node.js artifacts
	@echo "$(BLUE)ðŸ§¹ Cleaning Node.js artifacts...$(RESET)"
	@rm -rf node_modules
	@cd node && rm -rf dist node_modules
	@cd docker && rm -rf dist node_modules
	@cd vscode && rm -rf dist node_modules
	@cd shared && rm -rf dist node_modules

clean-golang: ## Maintenance - Clean Go artifacts
	@echo "$(BLUE)ðŸ§¹ Cleaning Go artifacts...$(RESET)"
	@cd golang && go clean

clean-swift: ## Maintenance - Clean Swift artifacts
	@echo "$(BLUE)ðŸ§¹ Cleaning Swift artifacts...$(RESET)"
	@cd swift && swift package clean

reset: ## Maintenance - Clean and reinstall everything
	@echo "$(BLUE)ðŸ”„ Resetting package ecosystem...$(RESET)"
	@$(MAKE) clean
	@$(MAKE) install

## ðŸ“Š Status & Info
status: ## Maintenance - Show package ecosystem status
	@echo "$(BLUE)ðŸ“Š Package Ecosystem Status:$(RESET)"
	@echo "$(GREEN)Node.js:$(RESET) $(shell node --version)"
	@echo "$(GREEN)pnpm:$(RESET) $(shell pnpm --version)"
	@echo "$(GREEN)Go:$(RESET) $(shell go version 2>/dev/null || echo 'Not installed')"
	@echo "$(GREEN)Swift:$(RESET) $(shell swift --version 2>/dev/null || echo 'Not installed')"
	@echo ""
	@echo "$(BLUE)ðŸ“¦ Available Packages:$(RESET)"
	@echo "  $(GREEN)âœ…$(RESET) Node.js SDK (Ready)"
	@echo "  $(GREEN)âœ…$(RESET) Go SDK (Ready)"
	@echo "  $(GREEN)âœ…$(RESET) Swift SDK (Ready)"
	@echo "  $(GREEN)âœ…$(RESET) Docker SDK (Ready)"
	@echo "  $(GREEN)âœ…$(RESET) GitHub App (Ready)"
	@echo "  $(YELLOW)ðŸ”„$(RESET) CLI Tool (Alpha)"
	@echo "  $(YELLOW)ðŸ”„$(RESET) VSCode Extension (Alpha)"
	@echo "  $(YELLOW)ðŸ”„$(RESET) Kubernetes Operator (Alpha)"
	@echo "  $(RED)ðŸš§$(RESET) Python SDK (In Progress)"
	@echo "  $(RED)ðŸš§$(RESET) Rust SDK (In Progress)"
	@echo "  $(RED)ðŸš§$(RESET) Java SDK (In Progress)"
	@echo "  $(RED)ðŸš§$(RESET) .NET SDK (Planned)"
	@echo "  $(RED)ðŸš§$(RESET) PHP SDK (Planned)"
	@echo "  $(RED)ðŸš§$(RESET) Ruby SDK (Planned)"

version: ## Maintenance - Show package versions
	@echo "$(BLUE)ðŸ“‹ Package Versions:$(RESET)"
	@$(PNPM) version

## ðŸ”— Cross-Package Commands
link-shared: ## Development - Link shared types to all packages
	@echo "$(BLUE)ðŸ”— Linking shared types...$(RESET)"
	@cd shared && $(PNPM) link
	@cd node && $(PNPM) link @aether-identity/shared
	@cd docker && $(PNPM) link @aether-identity/shared
	@cd vscode && $(PNPM) link @aether-identity/shared

## ðŸ§ª Integration Testing
integration-test: ## Test - Run integration tests
	@echo "$(BLUE)ðŸ§ª Running integration tests...$(RESET)"
	@echo "$(YELLOW)Integration tests should be run from the root Makefile$(RESET)"
	@echo "Run: make test-integration"

## ðŸ“š Documentation
docs: ## Development - Generate package documentation
	@echo "$(BLUE)ðŸ“š Generating documentation...$(RESET)"
	@cd node && $(PNPM) docs 2>/dev/null || echo "$(YELLOW)No docs script for Node.js SDK$(RESET)"
	@cd golang && godoc -http=:6060 &
	@echo "$(GREEN)âœ… Go docs server started at http://localhost:6060$(RESET)"
