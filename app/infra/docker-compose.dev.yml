version: "3.9"

services:
  app-dev:
    build:
      context: ..
      dockerfile: infra/Dockerfile.dev
    container_name: aether-identity-frontend-dev

    # Le port est uniquement visible dans le rÃ©seau Docker
    expose:
      - "3001"

    environment:
      NODE_ENV: development
      PORT: 3001
      HOSTNAME: 0.0.0.0
      CHOKIDAR_USEPOLLING: "true"

    working_dir: /app
    user: root

    volumes:
      - ..:/app:cached
      - app_node_modules:/app/node_modules
      - app_next:/app/.next

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3001"]
      interval: 20s
      timeout: 5s
      retries: 3
      start_period: 30s

    # ðŸ”‘ Indexation par Traefik (lâ€™infra dÃ©cide de lâ€™exposition)
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.aether-app.rule=Host(`localhost`) || Host(`aether.local`)"
      - "traefik.http.routers.aether-app.entrypoints=web"
      - "traefik.http.services.aether-app.loadbalancer.server.port=3001"
      - "traefik.http.routers.aether-app.priority=1"

    networks:
      - aether-network-dev

networks:
  aether-network-dev:
    name: aether-network-dev
    driver: bridge

volumes:
  app_node_modules:
  app_next:
