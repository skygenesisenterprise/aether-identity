{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/liam/Bureau/enterprise/aether-identity/app/lib/navigation-config.ts"],"sourcesContent":["/**\n * Navigation Configuration\n * \n * Controls navigation behavior based on environment mode\n */\n\nexport type NavigationMode = 'development' | 'production';\n\nexport const NAVIGATION_MODE = (\n  process.env.NEXT_PUBLIC_NAVIGATION_MODE || 'development'\n) as NavigationMode;\n\n/**\n * Check if free navigation is enabled\n */\nexport const isFreeNavigationEnabled = (): boolean => {\n  return NAVIGATION_MODE === 'development';\n};\n\n/**\n * Routes that require authentication in production mode\n */\nexport const PROTECTED_ROUTES = [\n  '/dashboard',\n  '/projects',\n  '/users',\n  '/settings',\n  '/profile',\n  '/inbox',\n  '/logs',\n];\n\n/**\n * Routes that are always accessible (public routes)\n */\nexport const PUBLIC_ROUTES = [\n  '/',\n  '/login',\n  '/auth/forgot-password',\n  '/auth/reset-password',\n  '/docs/swagger',\n];\n\n/**\n * Check if a route requires authentication\n */\nexport const isProtectedRoute = (path: string): boolean => {\n  return PROTECTED_ROUTES.some(route => path.startsWith(route));\n};\n\n/**\n * Check if a route is public\n */\nexport const isPublicRoute = (path: string): boolean => {\n  return PUBLIC_ROUTES.some(route => path.startsWith(route));\n};\n\n/**\n * Determine if authentication should be required for a route\n */\nexport const requiresAuthentication = (path: string): boolean => {\n  // In development mode, no authentication required\n  if (isFreeNavigationEnabled()) {\n    return false;\n  }\n  \n  // In production mode, check if route is protected\n  return isProtectedRoute(path);\n};"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;;;;;AAIM,MAAM,kBACX,QAAQ,GAAG,CAAC,2BAA2B,IAAI;AAMtC,MAAM,0BAA0B;IACrC,OAAO,oBAAoB;AAC7B;AAKO,MAAM,mBAAmB;IAC9B;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAKM,MAAM,gBAAgB;IAC3B;IACA;IACA;IACA;IACA;CACD;AAKM,MAAM,mBAAmB,CAAC;IAC/B,OAAO,iBAAiB,IAAI,CAAC,CAAA,QAAS,KAAK,UAAU,CAAC;AACxD;AAKO,MAAM,gBAAgB,CAAC;IAC5B,OAAO,cAAc,IAAI,CAAC,CAAA,QAAS,KAAK,UAAU,CAAC;AACrD;AAKO,MAAM,yBAAyB,CAAC;IACrC,kDAAkD;IAClD,IAAI,2BAA2B;QAC7B,OAAO;IACT;IAEA,kDAAkD;IAClD,OAAO,iBAAiB;AAC1B"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///home/liam/Bureau/enterprise/aether-identity/infrastructure/monitoring/proxy.ts"],"sourcesContent":["export function monitoringProxy(request: Request) {\n  const url = new URL(request.url);\n  const pathname = url.pathname;\n\n  // Grafana dashboard proxy\n  if (pathname.startsWith(\"/monitoring/grafana\")) {\n    const grafanaUrl = process.env.GRAFANA_URL || \"http://localhost:3001\";\n    const newPath = pathname.replace(\"/monitoring/grafana\", \"\") || \"/\";\n\n    const grafanaApiUrl = new URL(newPath, grafanaUrl);\n\n    // Copy query parameters\n    url.searchParams.forEach((value, key) => {\n      grafanaApiUrl.searchParams.set(key, value);\n    });\n\n    // Prepare headers\n    const headers = new Headers(request.headers);\n\n    // Add Grafana authentication if configured\n    const grafanaUser = process.env.GRAFANA_USER;\n    const grafanaPassword = process.env.GRAFANA_PASSWORD;\n\n    if (grafanaUser && grafanaPassword) {\n      const auth = Buffer.from(`${grafanaUser}:${grafanaPassword}`).toString(\n        \"base64\",\n      );\n      headers.set(\"Authorization\", `Basic ${auth}`);\n    }\n\n    // Forward client info for Grafana analytics\n    headers.set(\n      \"X-Forwarded-For\",\n      request.headers.get(\"x-forwarded-for\") || \"\",\n    );\n    headers.set(\n      \"X-Forwarded-Proto\",\n      request.headers.get(\"x-forwarded-proto\") || \"http\",\n    );\n    headers.set(\"X-Forwarded-Host\", request.headers.get(\"host\") || \"\");\n\n    return new Request(grafanaApiUrl, {\n      method: request.method,\n      headers,\n      body: request.body,\n      redirect: \"manual\",\n    });\n  }\n\n  // Prometheus API proxy\n  if (pathname.startsWith(\"/monitoring/prometheus\")) {\n    const prometheusUrl = process.env.PROMETHEUS_URL || \"http://localhost:9090\";\n    const newPath = pathname.replace(\"/monitoring/prometheus\", \"\") || \"/\";\n\n    const prometheusApiUrl = new URL(newPath, prometheusUrl);\n\n    // Copy query parameters\n    url.searchParams.forEach((value, key) => {\n      prometheusApiUrl.searchParams.set(key, value);\n    });\n\n    // Prepare headers\n    const headers = new Headers(request.headers);\n\n    // Forward client info\n    headers.set(\n      \"X-Forwarded-For\",\n      request.headers.get(\"x-forwarded-for\") || \"\",\n    );\n    headers.set(\"X-Webhook-URL\", request.headers.get(\"x-webhook-url\") || \"\");\n\n    return new Request(prometheusApiUrl, {\n      method: request.method,\n      headers,\n      body: request.body,\n      redirect: \"manual\",\n    });\n  }\n\n  // Loki logs proxy\n  if (pathname.startsWith(\"/monitoring/loki\")) {\n    const lokiUrl = process.env.LOKI_URL || \"http://localhost:3100\";\n    const newPath = pathname.replace(\"/monitoring/loki\", \"\") || \"/\";\n\n    const lokiApiUrl = new URL(newPath, lokiUrl);\n\n    // Copy query parameters\n    url.searchParams.forEach((value, key) => {\n      lokiApiUrl.searchParams.set(key, value);\n    });\n\n    // Prepare headers\n    const headers = new Headers(request.headers);\n\n    // Forward authentication for Loki\n    const lokiToken = process.env.LOKI_TOKEN;\n    if (lokiToken) {\n      headers.set(\"Authorization\", `Bearer ${lokiToken}`);\n    }\n\n    return new Request(lokiApiUrl, {\n      method: request.method,\n      headers,\n      body: request.body,\n      redirect: \"manual\",\n    });\n  }\n\n  return null; // Let Next.js handle it\n}\n\nexport const monitoringProxyConfig = {\n  matcher: [\"/monitoring/:path*\"],\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///home/liam/Bureau/enterprise/aether-identity/proxy.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\nimport { requiresAuthentication } from \"./app/lib/navigation-config\";\n\n// Import specialized proxies\nimport { monitoringProxy } from \"./infrastructure/monitoring/proxy\";\n\nexport function proxy(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  // Debug logs (uniquement en développement)\n  if (process.env.NODE_ENV === \"development\") {\n    console.log(\"Middleware - pathname:\", pathname);\n    console.log(\"Middleware - NODE_ENV:\", process.env.NODE_ENV);\n    console.log(\"Middleware - BACKEND_URL:\", process.env.BACKEND_URL);\n  }\n\n  if (pathname.startsWith(\"/monitoring/\")) {\n    const monitoringRequest = monitoringProxy(request);\n    if (monitoringRequest) {\n      return fetch(monitoringRequest);\n    }\n  }\n\n  // Ne pas intercepter les autres requêtes API ou /health\n  if (pathname.startsWith(\"/api/\") || pathname.startsWith(\"/health\")) {\n    return NextResponse.next();\n  }\n\n  const publicPaths = [\"/login\", \"/register\", \"/forgot-password\"];\n  const isPublicPath = publicPaths.some((path) => pathname.startsWith(path));\n  const isAdminPath = pathname.startsWith(\"/admin\");\n\n  const token =\n    request.cookies.get(\"authToken\")?.value ||\n    request.headers.get(\"authorization\")?.replace(\"Bearer \", \"\");\n\n  if (\n    !isPublicPath &&\n    !isAdminPath &&\n    requiresAuthentication(pathname) &&\n    !token\n  ) {\n    const loginUrl = new URL(\"/login\", request.url);\n    loginUrl.searchParams.set(\"returnUrl\", pathname);\n    return NextResponse.redirect(loginUrl);\n  }\n\n  if (isPublicPath && token && !isAdminPath) {\n    return NextResponse.redirect(new URL(\"/dashboard\", request.url));\n  }\n\n  const response = NextResponse.next();\n\n  if (process.env.NODE_ENV === \"production\") {\n    response.headers.set(\"X-Forwarded-Proto\", \"https\");\n    response.headers.set(\"X-Forwarded-Host\", request.headers.get(\"host\") || \"\");\n  }\n\n  return response;\n}\n\nexport const config = {\n  matcher: [\n    \"/((?!api|_next|favicon.ico|.*\\\\.svg|.*\\\\.png|.*\\\\.jpg|.*\\\\.jpeg|.*\\\\.gif|.*\\\\.webp).*)\",\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AAEA,6BAA6B;AAC7B;;;;AAEO,SAAS,MAAM,OAAoB;IACxC,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,2CAA2C;IAC3C,wCAA4C;QAC1C,QAAQ,GAAG,CAAC,0BAA0B;QACtC,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,6BAA6B,QAAQ,GAAG,CAAC,WAAW;IAClE;IAEA,IAAI,SAAS,UAAU,CAAC,iBAAiB;QACvC,MAAM,oBAAoB,IAAA,wJAAe,EAAC;QAC1C,IAAI,mBAAmB;YACrB,OAAO,MAAM;QACf;IACF;IAEA,wDAAwD;IACxD,IAAI,SAAS,UAAU,CAAC,YAAY,SAAS,UAAU,CAAC,YAAY;QAClE,OAAO,qRAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,cAAc;QAAC;QAAU;QAAa;KAAmB;IAC/D,MAAM,eAAe,YAAY,IAAI,CAAC,CAAC,OAAS,SAAS,UAAU,CAAC;IACpE,MAAM,cAAc,SAAS,UAAU,CAAC;IAExC,MAAM,QACJ,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc,SAClC,QAAQ,OAAO,CAAC,GAAG,CAAC,kBAAkB,QAAQ,WAAW;IAE3D,IACE,CAAC,gBACD,CAAC,eACD,IAAA,4JAAsB,EAAC,aACvB,CAAC,OACD;QACA,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,aAAa;QACvC,OAAO,qRAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,IAAI,gBAAgB,SAAS,CAAC,aAAa;QACzC,OAAO,qRAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;IAChE;IAEA,MAAM,WAAW,qRAAY,CAAC,IAAI;IAElC;;IAKA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}